# Техническая документация проекта EventMap

## Содержание

1. [Архитектура проекта](#архитектура-проекта)
2. [Структура файлов и директорий](#структура-файлов-и-директорий)
3. [Описание компонентов](#описание-компонентов)
4. [Контексты и управление состоянием](#контексты-и-управление-состоянием)
5. [Маршрутизация](#маршрутизация)
6. [Работа с картами](#работа-с-картами)
7. [Фильтрация событий](#фильтрация-событий)
8. [UI библиотека](#ui-библиотека)
9. [Расширение функциональности](#расширение-функциональности)
10. [Руководство по внесению изменений](#руководство-по-внесению-изменений)

## Архитектура проекта:

- **Компонентная архитектура** - приложение разделено на небольшие переиспользуемые компоненты
- **Контекстная система** - для управления глобальным состоянием используются React Context API
- **Маршрутизация** - навигация между страницами реализована с помощью React Router
- **Интеграция карт** - используется Leaflet для работы с интерактивными картами
- **Дизайн система** - стилизация с использованием Tailwind CSS и библиотеки компонентов shadcn/ui

## Структура файлов и директорий

```
/src
  /components         # Переиспользуемые компоненты
    /ui               # UI компоненты из shadcn/ui
    Layout.tsx        # Основная структура приложения
    Navbar.tsx        # Верхняя навигационная панель
    Sidebar.tsx       # Боковая панель со списком событий
    EventMap.tsx      # Компонент карты с событиями
    EventFilters.tsx  # Фильтры для событий
    EventListItem.tsx # Элемент списка событий
    
  /contexts           # React контексты для управления состоянием
    AuthContext.tsx   # Контекст для аутентификации
    EventsContext.tsx # Контекст для управления событиями
    MapContext.tsx    # Контекст для работы с картой
    
  /hooks              # Кастомные React хуки
    use-mobile.tsx    # Хук для определения мобильных устройств
    
  /pages              # Компоненты страниц
    MapView.tsx       # Главная страница с картой
    EventDetail.tsx   # Детальная страница события
    CreateEvent.tsx   # Страница для создания события
    Profile.tsx       # Профиль пользователя
    About.tsx         # Информация о системе
    NotFound.tsx      # Страница 404
    
  App.tsx             # Корневой компонент приложения
  main.tsx            # Точка входа в приложение
```

## Описание компонентов

### Layout (Layout.tsx)
Основной макет приложения, содержит структуру с боковой панелью и основным контентом. Управляет состоянием открытия/закрытия боковой панели, особенно на мобильных устройствах.

```tsx
// Основные функции:
- Отображение навигационной панели (Navbar) и боковой панели (Sidebar)
- Адаптивность для мобильных устройств
- Переключение видимости боковой панели
```

### Sidebar (Sidebar.tsx)
Боковая панель приложения, отображает фильтры и список событий. На мобильных устройствах может быть скрыта/показана.

```tsx
// Основные функции:
- Отображение списка событий
- Предоставление фильтров для событий
- Адаптивный интерфейс для мобильных устройств
```

### EventFilters (EventFilters.tsx)
Компонент для фильтрации списка событий по категориям и датам.

```tsx
// Основные функции:
- Фильтрация по категориям
- Фильтрация по диапазону дат
- Сброс фильтров
```

### EventListItem (EventListItem.tsx)
Карточка события для отображения в боковой панели и на других страницах.

```tsx
// Основные функции:
- Отображение основной информации о событии (название, дата, адрес)
- Отображение изображения события
- Индикация премиум-статуса
- Ссылка на детальную страницу события
```

### EventMap (EventMap.tsx)
Интерактивная карта с маркерами событий.

```tsx
// Основные функции:
- Отображение карты с использованием Leaflet
- Размещение маркеров событий на карте
- Навигация по карте
- Связь с контекстом карты для синхронизации состояния
```

## Контексты и управление состоянием

### AuthContext
Контекст для управления аутентификацией и пользовательскими данными.

```tsx
// Основные функции:
- Управление состоянием аутентификации
- Хранение информации о текущем пользователе
- Методы для входа, регистрации и выхода
- Проверка премиум-статуса пользователя
```

### EventsContext
Центральный контекст для управления данными о событиях.

```tsx
// Основные функции:
- Хранение списка всех событий
- Фильтрация событий по различным критериям
- Добавление новых событий
- Доступ к данным конкретного события по ID
```

### MapContext
Контекст для управления состоянием и взаимодействием с картой.

```tsx
// Основные функции:
- Хранение текущего центра и масштаба карты
- Управление перемещением по карте
- Отслеживание выбранного события на карте
- Индикация загрузки карты
```

## Маршрутизация

Маршрутизация в приложении реализована с использованием React Router:

```tsx
// App.tsx
<BrowserRouter>
  <Routes>
    <Route path="/" element={<Layout />}>
      <Route index element={<MapView />} />
      <Route path="events/:id" element={<EventDetail />} />
      <Route path="create" element={<CreateEvent />} />
      <Route path="profile" element={<Profile />} />
      <Route path="about" element={<About />} />
    </Route>
    <Route path="*" element={<NotFound />} />
  </Routes>
</BrowserRouter>
```

## Работа с картами

Приложение использует библиотеку Leaflet (через React Leaflet) для отображения интерактивной карты:

- Карта инициализируется с использованием компонента `MapContainer` из react-leaflet
- События отображаются как маркеры на карте
- При выборе события на карте происходит навигация к соответствующей детальной странице

## Фильтрация событий

Система фильтрации реализована в компоненте EventFilters и интегрирована с EventsContext:

- Фильтрация по категории события
- Фильтрация по диапазону дат с использованием календаря
- Состояние фильтров хранится в EventsContext и применяется к списку событий

## UI библиотека

Приложение использует комбинацию Tailwind CSS и shadcn/ui:

- **Tailwind CSS**: утилитарный CSS-фреймворк для быстрой стилизации компонентов
- **shadcn/ui**: компоненты, построенные на Radix UI и стилизованные с Tailwind CSS

### Интеграция с беком

1. Создать сервисный слой в новой директории `/services`
2. Реализовать функции для работы с API
3. Связать данные с существующими контекстами, например:

```tsx
// services/api.ts
export const fetchEventsFromAPI = async () => {
  const response = await fetch('https://api.example.com/events');
  return await response.json();
}

// Использование в EventsContext
useEffect(() => {
  const loadEvents = async () => {
    const eventsData = await fetchEventsFromAPI();
    setEvents(eventsData);
  };
  loadEvents();
}, []);
```

## Руководство по внесению изменений

### Добавление нового компонента

1. Создайть файл компонента в соответствующей поддиректории `/components`
2. Типизируем с помощью TypeScript входные пропрсы
3. Импортируй и используйте компонент там, где это необходимо

### Модификация логики работы с событиями

1. Внеси изменения в `EventsContext.tsx`, добавив новые методы или изменив существующие
2. Обнови компоненты, использующие контекст, для работы с новой функциональностью
3. При добавлении новых полей в интерфейс `Event`, обнови все соответствующие компоненты

### Работа с картой

1. Изменения в отображении карты и маркеров вносятся в компонент `EventMap.tsx`
2. Для изменения логики взаимодействия с картой обновите `MapContext.tsx`